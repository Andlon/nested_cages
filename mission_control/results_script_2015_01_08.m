% Script to generate results with volumetric_arap on the Imac

% [V0,F0] = load_mesh('/Users/leokollersacht/Documents/nested_cages/Meshes/Results/anchor_volume/anchor_0.obj');
% levels = floor(2.^((-14:2:-8)/3)*size(F0,1));
% [cages_V,cages_F,~,~,~,timing] = ...
%   multires_per_layer( ...
%   V0,F0, ...
%   levels, ...
%   'QuadratureOrder',2, ...
%   'ExpansionEnergy','volumetric_arap', ...
%   'FinalEnergy','none', ...
%   'BetaInit',1e-2, ...
%   'Eps',1e-3);
% write_cages('/Users/leokollersacht/Documents/nested_cages/Meshes/Results/anchor_volumetric_arap/anchor',cages_V,cages_F);
% save('/Users/leokollersacht/Documents/nested_cages/Meshes/Results/anchor_volumetric_arap/timing.mat','timing')
% % Obs.: Flow problems, moving on

% [V0,F0] = load_mesh('/Users/leokollersacht/Documents/nested_cages/Meshes/Results/arma_volume/arma_0.obj');
% levels = floor(2.^((-14:2:-4)/3)*size(F0,1));
% [cages_V,cages_F,~,~,~,timing] = ...
%   multires_per_layer( ...
%   V0,F0, ...
%   levels, ...
%   'QuadratureOrder',2, ...
%   'ExpansionEnergy','volumetric_arap', ...
%   'FinalEnergy','none', ...
%   'BetaInit',1e-2, ...
%   'Eps',1e-3);
% write_cages('/Users/leokollersacht/Documents/nested_cages/Meshes/Results/arma_volumetric_arap/arma',cages_V,cages_F);
% save('/Users/leokollersacht/Documents/nested_cages/Meshes/Results/arma_volumetric_arap/timing.mat','timing')
% % Obs.:
% 
% [V0,F0] = load_mesh('/Users/leokollersacht/Documents/nested_cages/Meshes/Results/bunny_volume/bunny_0.obj');
% levels = floor(2.^((-14:2:-4)/3)*size(F0,1));
% [cages_V,cages_F,~,~,~,timing] = ...
%   multires_per_layer( ...
%   V0,F0, ...
%   levels, ...
%   'QuadratureOrder',2, ...
%   'ExpansionEnergy','volumetric_arap', ...
%   'FinalEnergy','none', ...
%   'BetaInit',1e-2, ...
%   'Eps',1e-3);
% write_cages('/Users/leokollersacht/Documents/nested_cages/Meshes/Results/bunny_volumetric_arap/bunny',cages_V,cages_F);
% save('/Users/leokollersacht/Documents/nested_cages/Meshes/Results/bunny_volumetric_arap/timing.mat','timing')
% % Obs.: OK
% 
% [V0,F0] = load_mesh('/Users/leokollersacht/Documents/nested_cages/Meshes/Results/gargo_volume/gargo_0.obj');
% levels = floor(2.^((-14:2:-2)/3)*size(F0,1));
% [cages_V,cages_F,~,~,~,timing] = ...
%   multires_per_layer( ...
%   V0,F0, ...
%   levels, ...
%   'QuadratureOrder',2, ...
%   'ExpansionEnergy','volumetric_arap', ...
%   'FinalEnergy','none', ...
%   'BetaInit',1e-2, ...
%   'Eps',1e-3);
% write_cages('/Users/leokollersacht/Documents/nested_cages/Meshes/Results/gargo_volumetric_arap/gargo',cages_V,cages_F);
% save('/Users/leokollersacht/Documents/nested_cages/Meshes/Results/gargo_volumetric_arap/timing.mat','timing')
% % Obs.: OK

% [V0,F0] = load_mesh('/Users/leokollersacht/Documents/nested_cages/Meshes/Results/horse_volume/horse_0.obj');
% levels = 1000:1000:25000;
% [cages_V,cages_F,~,~,~,timing] = ...
%   multires_per_layer( ...
%   V0,F0, ...
%   levels, ...
%   'QuadratureOrder',2, ...
%   'ExpansionEnergy','surface_arap', ...
%   'FinalEnergy','none', ...
%   'BetaInit',1e-2, ...
%   'Eps',1e-3);
% write_cages('/Users/leokollersacht/Documents/nested_cages/Meshes/Results/horse_arap_25/horse',cages_V,cages_F);
% save('/Users/leokollersacht/Documents/nested_cages/Meshes/Results/horse_arap_25/timing.mat','timing')
% % Obs.: a small bump was maginified across layers

% [V0,F0] = load_mesh('/Users/leokollersacht/Documents/nested_cages/Meshes/Results/pelvis_volume/pelvis_0.obj');
% levels = 5000:500:30000;
% [cages_V,cages_F,~,~,~,timing] = ...
%   multires_per_layer( ...
%   V0,F0, ...
%   levels, ...
%   'QuadratureOrder',2, ...
%   'ExpansionEnergy','surface_arap', ...
%   'FinalEnergy','none', ...
%   'BetaInit',1e-2, ...
%   'Eps',1e-3);
% write_cages('/Users/leokollersacht/Documents/nested_cages/Meshes/Results/pelvis_arap_50/pelvis',cages_V,cages_F);
% save('/Users/leokollersacht/Documents/nested_cages/Meshes/Results/pelvis_arap_50/timing.mat','timing')
% % Obs.: Difficult collision resolving for the first layer

% [V0,F0] = load_mesh('/Users/leokollersacht/Documents/nested_cages/Meshes/Results/horse_volume/horse_0.obj');
% levels = 1000:1000:25000;
% [cages_V,cages_F,~,~,~,timing] = ...
%   multires_per_layer( ...
%   V0,F0, ...
%   levels, ...
%   'QuadratureOrder',2, ...
%   'ExpansionEnergy','surface_arap', ...
%   'FinalEnergy','none', ...
%   'BetaInit',1e-2, ...
%   'Eps',1e-5);
% write_cages('/Users/leokollersacht/Documents/nested_cages/Meshes/Results/horse_arap_25_eps1e5/horse',cages_V,cages_F);
% save('/Users/leokollersacht/Documents/nested_cages/Meshes/Results/horse_arap_25_eps1e5/timing.mat','timing')
% % Obs.: OK

[V0,F0] = load_mesh('/Users/leokollersacht/Documents/nested_cages/Meshes/Results/maxplank_200k_varap/maxplank_200k_0.obj');
V0 = V0/max(max(abs(V0)));
% % Illegal instruction: 4 (wtf?)
% levels = 1000:1000:50000;
% % Illegal instruction: 4 (wtf?)
% levels = 1000:500:25000;
levels = 1000:500:10000;
[cages_V,cages_F,~,~,~,timing] = ...
  multires_per_layer( ...
  V0,F0, ...
  levels, ...
  'QuadratureOrder',2, ...
  'ExpansionEnergy','surface_arap', ...
  'FinalEnergy','none', ...
  'BetaInit',1e-2, ...
  'Eps',1e-3);
write_cages('/Users/leokollersacht/Documents/nested_cages/Meshes/Results/maxplank_200k_varap/maxplank_200k',cages_V,cages_F);
save('/Users/leokollersacht/Documents/nested_cages/Meshes/Results/maxplank_200k_varap/timing.mat','timing')
% Obs.:

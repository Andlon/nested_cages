\section*{Appendix B: Pseudocode}
%
\label{app:pseudocode}
\vspace{-5mm}

\begin{algorithm}
  \caption{$\text{Shrink}(\Cinp,\Fout) \rightarrow H$}
  \KwData{\\
    \begin{tabular}{ll}
      $\Cinp$ &  Initial coarse mesh (will remain constant) \\
      $\Fout$ &  Initial fine mesh (possibly overlapping with $\Cinp$) \\
    \end{tabular}
  }
  \KwResult
  {\\
    \begin{tabular}{ll}
      $H$  & Fine mesh history:
      $H \leftarrow \{\FVflow(0),\FVflow(∆t),\dots,\FVflow(N∆t)\}$
    \end{tabular}
  }
  \Begin{
    $H ← \{ F \}$ \comment{Initialize history with input fine mesh} \\
    \While{\upshape{$\Cinp$ does not nest $H$\text{.last}}}
    {
    $\nabla Φ  ← 0$ \comment{Initialize gradients to zero} \\
    \For{\upshape{each quadrature point $\pflow_i $ on $H$.last}}
    {
      $\q ← \text{closest point to } \pflow_i \text{ on }\Cinp$ \\
      $s ← \left\{
        \begin{array}{rl} 
           1 & \text{ if }\pflow_i\text{ is outside }\Cinp \\
          -1 & \text{otherwise} 
        \end{array} 
      \right.$ \comment{distance sign} \\
	 \uIf {$\| \pflow_i - \q \| > 1\mbox{\upshape{e}-}5$}
	 {
          $\g ← s (\pflow_i-\q)/\|\pflow_i - \q\|$ \\
	 }
	 \Else{
           \longcomment{if too close use normal \cite{Baerentzen:2005:SDC}}\\
           $\g ← \n(\q)$\\
         }
         \For{\upshape{each vertex $j$ in $H$.last}}
         {
            \longcomment{$w_i$ is the weight of the quadrature point and
            $\lambda_{ij}$ is the hat function of vertex $j$ evaluated at
            quadrature point $\pflow_i$}\\
            $\nabla Φ (j) ← Φ(j) +  w_i \lambda_{ij} \g$\\
         }        
         
    }
    $∆t ← 1\mbox{\text{e}-}3$ \comment{Default time step} \\
    $ H \text{.push}( H\text{.last} - ∆t \cdot \nabla Φ$  )
    }
  }
  \label{alg:shrink}
\end{algorithm}
\vspace*{-5mm}

\begin{algorithm}
  \caption{$\text{Reinflate}(H,\Cinp,\text{Energy}) \rightarrow C$}
  \KwData{\\
    \begin{tabular}{ll}
      $H$  & Fine mesh history:
      $H \leftarrow \{\FVflow(0),\FVflow(∆t),\dots,\FVflow(N∆t)\}$ \\
      $\Cinp$ &  Initial coarse mesh \\
      Energy &  Function object for re-inflation energy and gradient
    \end{tabular}
  }
  \KwResult
  {\\
    \begin{tabular}{ll}
      $C$ & Final nested cage \\
    \end{tabular}
  }
  \Begin{
    $F_0 ← H$.first \comment{initial fine mesh}\\
    $F ← H$.pop \comment{shrunken fine mesh}\\
    $C ← \Cinp$ \comment{initialize output cage}\\
    \While{\upshape{$H$ is not empty}}
    {
    $β ← β_{\text{init}} ( \ = 1\mbox{\text{e}-}2)$ \comment{Initial step size} \\
    $E_{\text{min}} ← \infty$ \comment{Initial minimum energy} \\
    $\U_F ← H\text{.pop} - F $ \comment{Desired velocities for fine mesh} \\
    \Repeat{
      $\U_C ← - β \ \nabla \text{Energy} (F_0,C,\Cinp)$
       \comment{\ditto{} coarse mesh} \\
       \longcomment{Filter velocities, e.g.\ modified \cite{Brochu:2009} or
        \cite{Ainsley:2012:SPA}}\\
       $\U_C ← \text{Filter}(F,\U_F,C,\U_C)$\\
	 \uIf {\upshape{Energy}$(C+\U_C)>E_{\text{min}}$}
	 {
	 $β ← β/2$ \comment{Decrease step size} \\
	 \lIf{$β < β_{\text{min}} ( \ = 1\mbox{\upshape{e}-}3)$} 
	 {
	    \textbf{break} \comment{No progress}
	 }
	}
	 \Else{
		$C ← C +\U_C$ \comment{Step coarse mesh} \\
         	$E_{\text{min}} ← \text{Energy}(C)$ \comment{Update energy}\\
		$β ← 1.1 β$ \comment{Slightly increase step size}
         }  
         \lIf{$\| \U_C \| < ∆C (=1\mbox{\upshape{e}-}5)$}
	 {
	    \textbf{break} \comment{"Converged"} 
	 }
    }
    $F ← F + \U_F$ \comment{Step fine mesh}

    }
  }
  \label{alg:reinflate}
\end{algorithm}
